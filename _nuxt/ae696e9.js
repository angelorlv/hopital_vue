(window.webpackJsonp=window.webpackJsonp||[]).push([[107],{558:function(t,e,o){"use strict";o.r(e);var n=o(3),r=(o(56),o(25),{mixins:[o(77).a],data:function(){return{location:{},comments:{list:[],models:{com_content:""}},com_in_hover:-1}},methods:{getLocation:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.$get("api/a/ad/location/"+t.$route.params.id);case 3:(o=e.sent).status?t.location=o.location:(t.showNotif("Erreur",o.message,!0),t.router.go(-1)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t.showErrorConnexion();case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},validLocation:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.$put("api/a/ad/location/validate/"+t.$route.params.id);case 3:(o=e.sent).status?t.getLocation():t.showNotif("Erreur",o.message,!0),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t.showErrorConnexion();case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},getComments:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.$get("api/a/com/location/"+t.$route.params.id);case 3:(o=e.sent).status?t.comments.list=o.comments:t.showNotif("Erreur",o.message,!0),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t.showErrorConnexion();case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},deleteLocation:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!confirm("Voulez vous vraiment annuler la lréservation de ce panneau !!? \nL'annonceur recevra une notifification que sa réservation a été annulé. ")){e.next=7;break}return e.next=5,t.$axios.$delete("api/a/ad/location/"+t.$route.params.id);case 5:(o=e.sent).status?(t.showNotif("Suppressioin réservation","Suppression avec Succès."),setTimeout((function(){t.$router.go(-1)}),2e3)):t.showNotif("Erreur",o.message,!0);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),t.showErrorConnexion();case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))()},init:function(){this.comments.models={com_content:"",com_pr_type:this.$store.state.profil.pr_type,com_pr_id:this.$store.state.profil.pr_id,com_obj_id:this.$route.params.id,com_pr_login:this.$store.state.profil.pr_login,com_vu:0,com_date:""}},sendComments:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.comments.models.com_date=new Date,e.next=4,t.$axios.$post("api/a/com/location",t.comments.models);case 4:(o=e.sent).status?(t.comments.models.com_content="",t.setCommentsVu(t.$route.params.id,"a")):t.showNotif("Erreur",o.message,!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),t.showErrorConnexion();case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},deleteCom:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=t.comments.list[t.com_in_hover].com_id,e.next=4,t.$axios.$delete("api/a/com/location/"+t.$route.params.id,{params:{id:o,index:t.com_in_hover}});case 4:(n=e.sent).status||t.showNotif("Erreur",n.message,!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),t.showErrorConnexion();case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()}},mounted:function(){this.getLocation(),this.getComments(),this.init(),this.connectSocket(),this.setListenNotifAd(),this.setListenAddComments()}}),c=o(7),component=Object(c.a)(r,(function(){var t,e=this,o=e.$createElement,n=e._self._c||o;return n("div",{staticClass:"flex p-5 justify-center items-center w-full"},[n("div",{staticClass:"w-full lg:w-2/3"},[n("div",{staticClass:"w-full border rounded-lg"},[n("div",{staticClass:" h-24"},[null==e.location.image_id?n("div",{staticClass:"w-full h-full flex justify-center items-center "},[n("span",{staticClass:"p-2 rounded-full border-gray-400 border text-gray-400 "},[e._v(" Aucune image Disponible ")])]):null!=e.location.name_file?n("div",{staticClass:"h-full w-full flex "},[n("img",{staticClass:"object-cover flex-grow rounded-b-lg",attrs:{src:"/api/p/media/"+e.location.name_file,loading:"lazy",crossorigin:"anonymous"}})]):e._e()]),e._v(" "),n("div",{staticClass:"border-t flex w-full bg-gray-50"},[n("div",{staticClass:"w-1/2 p-2 flex flex-col"},[n("div",{staticClass:"flex flex-col"},[n("span",{staticClass:"text-xs font-bold"},[e._v("Référence panneau ")]),e._v(" "),n("span",[e._v(" "+e._s(e.location.pan_ref)+" ")])]),e._v(" "),n("div",{staticClass:"flex flex-col"},[n("span",{staticClass:"text-xs font-bold"},[e._v(" Catégorie ")]),e._v(" "),n("span",[e._v(" "+e._s(e.location.parent_cat_label)+" > "+e._s(e.location.cat_label)+" ")])])]),e._v(" "),n("div",{staticClass:"w-1/2 p-2 flex flex-col"},[n("div",{staticClass:"flex flex-col"},[n("span",{staticClass:"text-xs font-bold"},[e._v(" Durée de location ")]),e._v(" "),n("span",[e._v(" "+e._s(e.location.pan_loc_month)+" mois ")])]),e._v(" "),n("div",{staticClass:"flex flex-col"},[n("span",{staticClass:"text-xs font-bold"},[e._v(" Date début prévisionnelle ")]),e._v(" "),n("span",{},[e._v(" "+e._s(e.dateToText(e.location.pan_loc_date_debut))+" ")])]),e._v(" "),n("div",{staticClass:"flex flex-col"},[n("span",{staticClass:"text-xs font-bold"},[e._v(" Date fin prévisionnelle ")]),e._v(" "),n("span",{},[e._v(" "+e._s((t=new Date(e.location.pan_loc_date_debut),e.dateToText(t.setMonth(t.getMonth()+parseInt(e.location.pan_loc_month)))))+" ")])])])]),e._v(" "),e.location.pan_loc_validate?n("div",{staticClass:"p-2 bg-gray-100 flex"},[n("span",{staticClass:"text-indigo-600"},[e._v(" Location validée, le "+e._s(e.dateToText(e.location.pan_loc_date_validation))+" ")]),e._v(" "),n("span",{staticClass:"flex-grow"}),e._v(" "),n("span",{staticClass:"material-icons text-indigo-600"},[e._v("check_circle")])]):e._e()]),e._v(" "),n("div",{},[e.comments.list.length>0?n("div",{staticClass:"mt-2 flex flex-col-reverse"},e._l(e.comments.list,(function(t,i){return n("div",{key:t.com_id,staticClass:"duration-300 flex pb-2 ",on:{mouseover:function(t){e.com_in_hover=i}}},[e.$store.state.profil.pr_id==t.com_pr_id?n("span",{staticClass:"flex-grow"}):e._e(),e._v(" "),n("div",{staticClass:"flex justify-center mr-5 items-center"},[e.$store.state.profil.pr_id==t.com_pr_id&&e.com_in_hover==i?n("button",{staticClass:"bt text-sm",on:{click:e.deleteCom}},[e._v(" Supprimer ")]):e._e()]),e._v(" "),n("div",{staticClass:"rounded-lg border p-2 flex flex-col ",class:e.$store.state.profil.pr_id==t.com_pr_id?"text-white bg-indigo-600":""},[n("div",{staticClass:"text-sm font-bold"},["a"==t.com_pr_type?n("span",{},[e._v(" "+e._s(t.com_pr_id==e.$store.state.profil.pr_id?"Moi (Admin)":t.com_pr_login+" (Admin)")+" ")]):n("span",{},[e._v(" "+e._s(t.com_pr_login)+" ")])]),e._v(" "),n("span",{staticClass:" whitespace-pre-wrap break-words",domProps:{innerHTML:e._s(t.com_content)}}),e._v(" "),n("span",{staticClass:"text-xs"},[e._v(" "+e._s(e.dateBetweenNow(t.com_date))+" ")])])])})),0):n("div",{staticClass:"w-full flex justify-center items-center py-5"},[n("span",{staticClass:"text-xl text-gray-400"},[e._v(" Aucun Commentaire ")])]),e._v(" "),n("div",{staticClass:"flex flex-col sticky bottom-2 bg-white"},[e.location.pan_loc_reject?n("div",{staticClass:"p-2 rounded-lg bg-white border"},[n("span",{staticClass:"text-red-500"},[e._v("Cette réservation a été annulé")])]):n("div",{staticClass:"flex flex-col"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.comments.models.com_content,expression:"comments.models.com_content"}],staticClass:"input-alt w-full py-2",attrs:{placeholder:"Insérer ici votre commentaire ..."},domProps:{value:e.comments.models.com_content},on:{input:function(t){t.target.composing||e.$set(e.comments.models,"com_content",t.target.value)}}}),e._v(" "),n("div",{staticClass:"flex mt-2"},[e.location.pan_loc_validate?e._e():n("button",{staticClass:"bt text-sm mr-2",on:{click:e.validLocation}},[e._v("Valider la location")]),e._v(" "),e.location.pan_loc_validate?e._e():n("button",{staticClass:"bt-back text-sm ",on:{click:e.deleteLocation}},[e._v("Annuler")]),e._v(" "),n("span",{staticClass:"flex-grow"}),e._v(" "),n("button",{staticClass:"bt text-sm",on:{click:e.sendComments}},[e._v("Envoyer")])])])])])])])}),[],!1,null,null,null);e.default=component.exports}}]);