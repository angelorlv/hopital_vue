(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{498:function(t,e,o){"use strict";o.r(e);var n=o(3),r=(o(25),{mixins:[o(77).a],data:function(){return{location:{},comments:{list:[],models:{com_content:""}}}},methods:{getLocation:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.$get("api/a/annonceur/location/"+t.$route.params.id);case 3:(o=e.sent).status?t.location=o.location:(t.showNotif("Erreur",o.message,!0),t.router.go(-1)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t.showErrorConnexion();case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},getComments:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.$get("api/a/com/location/"+t.$route.params.id);case 3:(o=e.sent).status?t.comments.list=o.comments:t.showNotif("Erreur",o.message,!0),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t.showErrorConnexion();case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},init:function(){this.comments.models={com_content:"",com_pr_type:this.$store.state.profil.pr_type,com_pr_id:this.$store.state.profil.pr_id,com_obj_id:this.$route.params.id,com_pr_login:this.$store.state.profil.pr_login,com_date:""}},sendComments:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.comments.models.com_date=new Date,e.next=4,t.$axios.$post("api/a/com/location",t.comments.models);case 4:(o=e.sent).status?(t.comments.models.com_content="",t.setCommentsVu(t.$route.params.id,"a")):t.showNotif("Erreur",o.message,!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),t.showErrorConnexion();case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},delLocation:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function o(){var n;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,e.$axios.$delete("api/a/annonceur/location/"+t);case 3:(n=o.sent).status?(e.$router.go(-1),e.showNotif("Suppression de réservation","Réservation bien supprimé")):e.showNotif("Erreur",n.message,!0),o.next=10;break;case 7:o.prev=7,o.t0=o.catch(0),e.showErrorConnexion();case 10:case"end":return o.stop()}}),o,null,[[0,7]])})))()}},mounted:function(){this.getLocation(),this.getComments(),this.init(),this.connectSocket(),this.setListenNotif(),this.setListenAddComments()}}),c=o(7),component=Object(c.a)(r,(function(){var t,e=this,o=e.$createElement,n=e._self._c||o;return n("div",{staticClass:"flex p-5 justify-center items-center w-full"},[n("div",{staticClass:"w-full lg:w-2/3"},[n("div",{staticClass:"w-full border rounded-lg"},[n("div",{staticClass:" h-24"},[null==e.location.image_id?n("div",{staticClass:"w-full h-full flex justify-center items-center "},[n("span",{staticClass:"p-2 rounded-full border-gray-400 border text-gray-400 "},[e._v(" Aucune image Disponible ")])]):n("div",{staticClass:"h-full w-full flex "},[n("img",{staticClass:"object-cover flex-grow rounded-b-lg",attrs:{src:"/api/p/media/"+e.location.name_file,loading:"lazy",crossorigin:"anonymous"}})])]),e._v(" "),n("div",{staticClass:"border-t flex w-full bg-gray-50"},[n("div",{staticClass:"w-1/2 p-2 flex flex-col"},[n("div",{staticClass:"flex flex-col"},[n("span",{staticClass:"text-xs font-bold"},[e._v("Référence panneau ")]),e._v(" "),n("span",[e._v(" "+e._s(e.location.pan_ref)+" ")])]),e._v(" "),n("div",{staticClass:"flex flex-col"},[n("span",{staticClass:"text-xs font-bold"},[e._v(" Catégorie ")]),e._v(" "),n("span",[e._v(" "+e._s(e.location.parent_cat_label)+" > "+e._s(e.location.cat_label)+" ")])])]),e._v(" "),n("div",{staticClass:"w-1/2 p-2 flex flex-col"},[n("div",{staticClass:"flex flex-col"},[n("span",{staticClass:"text-xs font-bold"},[e._v(" Durée de location ")]),e._v(" "),n("span",[e._v(" "+e._s(e.location.pan_loc_month)+" mois ")])]),e._v(" "),n("div",{staticClass:"flex flex-col"},[n("span",{staticClass:"text-xs font-bold"},[e._v(" Date début prévisionnelle ")]),e._v(" "),n("span",{},[e._v(" "+e._s(e.dateToText(e.location.pan_loc_date_debut))+" ")])]),e._v(" "),n("div",{staticClass:"flex flex-col"},[n("span",{staticClass:"text-xs font-bold"},[e._v(" Date fin prévisionnelle ")]),e._v(" "),n("span",{},[e._v(" "+e._s((t=new Date(e.location.pan_loc_date_debut),e.dateToText(t.setMonth(t.getMonth()+parseInt(e.location.pan_loc_month)))))+" ")])])])]),e._v(" "),e.location.pan_loc_validate?n("div",{staticClass:"p-2 bg-gray-100 flex"},[n("span",{staticClass:"text-indigo-600"},[e._v(" Location validée, le "+e._s(e.dateToText(e.location.pan_loc_date_validation))+" ")]),e._v(" "),n("span",{staticClass:"flex-grow"}),e._v(" "),n("span",{staticClass:"material-icons text-indigo-600"},[e._v("check_circle")])]):e._e()]),e._v(" "),n("div",{},[e.comments.list.length>0?n("div",{staticClass:"mt-2 flex flex-col-reverse"},e._l(e.comments.list,(function(t){return n("div",{key:t.com_id,staticClass:"flex pb-2  "},[e.$store.state.profil.pr_id==t.com_pr_id?n("span",{staticClass:"flex-grow"}):e._e(),e._v(" "),n("div",{staticClass:"rounded-lg border p-2 flex flex-col",class:e.$store.state.profil.pr_id==t.com_pr_id?"text-white bg-indigo-600":"bg-white"},[n("div",{staticClass:"text-sm font-bold"},[e.$store.state.profil.pr_id==t.com_pr_id?n("span",{},[e._v("Moi")]):n("span",{},[e._v("Admin")])]),e._v(" "),n("span",{staticClass:" whitespace-pre-wrap",domProps:{innerHTML:e._s(t.com_content)}}),e._v(" "),n("span",{staticClass:"text-xs"},[e._v(" "+e._s(e.dateBetweenNow(t.com_date))+" ")])])])})),0):n("div",{staticClass:"w-full flex justify-center items-center py-5"},[n("span",{staticClass:"text-xl text-gray-400"},[e._v(" Aucun Commentaire ")])]),e._v(" "),n("div",{staticClass:" sticky bottom-2 bg-white p-2 rounded"},[e.location.pan_loc_reject?n("div",{staticClass:"p-2 rounded-lg bg-white border"},[n("span",{staticClass:"text-red-500"},[e._v("Cette réservation a été annulé")])]):n("div",{staticClass:"flex flex-col"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.comments.models.com_content,expression:"comments.models.com_content"}],staticClass:"input-alt w-full py-2",attrs:{placeholder:"Insérer ici votre commentaire ..."},domProps:{value:e.comments.models.com_content},on:{input:function(t){t.target.composing||e.$set(e.comments.models,"com_content",t.target.value)}}}),e._v(" "),n("div",{staticClass:"flex mt-2"},[n("button",{staticClass:"bt-back",on:{click:function(){e.delLocation(e.location.pan_loc_id)}}},[e._v("Annuler la réservation")]),e._v(" "),n("span",{staticClass:"flex-grow"}),e._v(" "),n("button",{staticClass:"bt text-sm",on:{click:e.sendComments}},[e._v("Envoyer")])])])])])])])}),[],!1,null,null,null);e.default=component.exports}}]);